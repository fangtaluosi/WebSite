<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta name="description" content="个人博客，分享生活 &#9885;墨璃暮湮·芳塔洛斯&#10031;的个人博客 努力奔跑，为了追上那个曾被寄予厚望的自己">
    <meta name="viewport" content="width=device-width, initial-scale=0.5, minimum-scale=0.5, maximum-scale=2.0">
    <title>芳塔洛斯</title>
    <link rel="Shortcut Icon" href=https://fangtaluosi.top/img/icon/logo.png>
    <link rel="alternate" type="application/rss+xml" title="RSS" href=https://fangtaluosi.top/atom.xml>
    <!-- 基本css -->
    <link rel="stylesheet" href=https://fangtaluosi.top/css/basic/basic.css>
    <!-- 主页基本css -->
    <link rel="stylesheet" href=https://fangtaluosi.top/css/page/index-basic.css>
    <!--loading组件与background组件-->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
    <!--snow组件-->
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script src="https://fangtaluosi.top/js/snow.js"></script>
    <!-- 返回顶部 -->
    <script src="https://fangtaluosi.top/js/nav.js"></script>
    <!-- 页脚飞鱼 -->
    <script src="https://fangtaluosi.top/js/fish.js"></script>
<!-- 文章内容 -->
<link rel="stylesheet" href=https://fangtaluosi.top/css/page/article-content.css>
<!-- 文章内容调整 -->
<script src=https://fangtaluosi.top/js/article-content.js></script>
<!-- katex数学渲染 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css"
    integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous">
<!-- The loading of KaTeX is deferred to speed up page rendering -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js"
    integrity="sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY" crossorigin="anonymous">
</script>
<!-- To automatically render math in text elements, include the auto-render extension: -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js"
    integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>
</head>

<body>
    <header>
<div class="search-wrap">
    <div class="searchBox">
        <div class="shadow"></div>
        <input type="text" placeholder="Search for...">
        <span class="iconfont icon-search"></span>
    </div>
</div>
</header>
    <nav>
        <!-- 导航栏 -->
<div class="nav-wrap">
    <div class="nav">
        <a class="icon" href=https://fangtaluosi.top/>
            <div class="icon-img"><img src=https://fangtaluosi.top/img/icon/logo-bg.png alt=""></div>
            <div class="icon-con">
                <p>Good day</p>
                <h2>芳塔洛斯</h2>
            </div>
        </a>
        <div class="nav-line"></div>
        <div class="title">
            <p>Page</p>
        </div>
        <div class="menu">
            <a class="item" href=https://fangtaluosi.top/>
                <div class="light"></div>
                <div class="licon">
                    <span class="iconfont icon-home_light"></span>
                </div>
                <div class="con">Home</div>
                <div class="ricon">
                    <span class="iconfont icon-shezhi"></span>
                </div>
            </a>
            <a class="item" href=https://fangtaluosi.top/resource>
                <div class="light"></div>
                <div class="licon">
                    <span class="iconfont icon-resource"></span>
                </div>
                <div class="con">Resource</div>
                <div class="ricon"></div>
            </a>
            <a class="item" href=https://fangtaluosi.top/blog>
                <div class="light"></div>
                <div class="licon">
                    <span class="iconfont icon-ego-blog"></span>
                </div>
                <div class="con">Blog</div>
                <div class="ricon"></div>
            </a>
            <a class="item" href=https://fangtaluosi.top/about>
                <div class="light"></div>
                <div class="licon">
                    <span class="iconfont icon-about"></span>
                </div>
                <div class="con">About</div>
                <div class="ricon"></div>
            </a>
            <a class="item" href=https://fangtaluosi.top/tags>
                <div class="light"></div>
                <div class="licon">
                    <span class="iconfont icon-tag"></span>
                </div>
                <div class="con">Tags</div>
                <div class="ricon"></div>
            </a>
        </div>

        <div class="nav-line"></div>
        <div class="title">
            <p>Sever</p>
        </div>
        <div class="serve">
            <div class="item">
                <div class="light"></div>
                <div class="licon">
                    <span class="iconfont icon-link"></span>
                </div>
                <div class="con">Contact</div>
                <div class="ricon"></div>
            </div>
            <div class="item">
                <div class="light"></div>
                <div class="licon">
                    <span class="iconfont icon-yinle"></span>
                </div>
                <div class="con">Music</div>
                <div class="ricon"></div>
            </div>
            <a href="javascript:void(0)" id="to-top">
                <div class="item">
                    <div class="light"></div>
                    <div class="licon">
                        <span class="iconfont icon-xiangshang"></span>
                    </div>
                    <div class="con">ToTop</div>
                    <div class="ricon"></div>
                </div>
            </a>
        </div>
    </div>
</div>
</nav>
    <aside>

    </aside>
    <main>
<div class="article-page-wrap">
    <h1 class="article-title">
        基于Bevy的扫雷游戏(长文警告)
    </h1>
    <p class="article-date"><strong>2022-03-05</strong></p>
    <h1 id="ji-yu-bevyyou-xi-yin-qing-de-sao-lei-you-xi">基于<a href="https://bevyengine.org/">Bevy</a>游戏引擎的扫雷游戏</h1>
<p>参考自<a href="https://dev.to/qongzi/bevy-minesweeper-introduction-4l7f">Bevy Minesweeper: Introduction - DEV Community</a></p>
<h2 id="jie-shao">介绍</h2>
<p>bevy是一个免费开源的游戏引擎，用rust编写，采用ECS范式，更多内容详见官网。下面我们来用这款引擎制作一个简单的扫雷游戏，最终成品大概如下</p>
<h2 id="zhun-bei">准备</h2>
<p>首先新建一个crate</p>
<ul>
<li><code>cargo new minesweeper</code>
我习惯将lib与bin合并在一个crate里，所以我们在src下新建一个lib.rs文件，现在的文件目录大概是这样：</li>
</ul>
<pre style="background-color:#eff1f5;color:#4f5b66;"><code><span>├── src</span><span>
</span><span>│   ├── main.rs</span><span>
</span><span>│ 	└── lib.rs</span><span>
</span><span>├── Cargo.toml</span><span>
</span></code></pre>
<p>接下来添加一下需要用到的crate
将以下元素添加到Cargo.toml中</p>
<pre data-lang="toml" style="background-color:#eff1f5;color:#4f5b66;" class="language-toml "><code class="language-toml" data-lang="toml"><span>[features]</span><span>
</span><span style="color:#bf616a;">default </span><span>= []</span><span>
</span><span style="color:#a7adba;"># 用于调试的feature</span><span>
</span><span style="color:#bf616a;">debug </span><span>= [&quot;</span><span style="color:#a3be8c;">colored</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">bevy-inspector-egui</span><span>&quot;]</span><span>
</span><span>
</span><span>[dependencies]</span><span>
</span><span style="color:#a7adba;"># bevy引擎本体</span><span>
</span><span style="color:#bf616a;">bevy </span><span>= &quot;</span><span style="color:#a3be8c;">0.6.1</span><span>&quot;</span><span>
</span><span style="color:#a7adba;"># 用于序列化数据</span><span>
</span><span style="color:#bf616a;">serde </span><span>= &quot;</span><span style="color:#a3be8c;">1.0</span><span>&quot;</span><span>
</span><span style="color:#a7adba;"># 生成随机数</span><span>
</span><span style="color:#bf616a;">rand </span><span>= &quot;</span><span style="color:#a3be8c;">0.8</span><span>&quot;</span><span>
</span><span style="color:#a7adba;"># 控制台调试，可彩色输出</span><span>
</span><span style="color:#bf616a;">colored </span><span>= { </span><span style="color:#bf616a;">version </span><span>= &quot;</span><span style="color:#a3be8c;">2.0</span><span>&quot;, </span><span style="color:#bf616a;">optional </span><span>= </span><span style="color:#d08770;">true </span><span>}</span><span>
</span><span style="color:#a7adba;"># 这是bevy社区的一个用于在游戏内调试数据的插件</span><span>
</span><span style="color:#bf616a;">bevy-inspector-egui </span><span>= { </span><span style="color:#bf616a;">version </span><span>= &quot;</span><span style="color:#a3be8c;">0.8</span><span>&quot;, </span><span style="color:#bf616a;">optional </span><span>= </span><span style="color:#d08770;">true </span><span>}</span><span>
</span></code></pre>
<h2 id="bian-xie-ji-ben-jie-gou">编写基本结构</h2>
<p>首先我们在lib.rs里创建一个bevy的plugin，也就是一个结构体</p>
<pre data-lang="rust" style="background-color:#eff1f5;color:#4f5b66;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#a7adba;">// src/lib.rs</span><span>
</span><span>
</span><span style="color:#a7adba;">/// 游戏面板插件</span><span>
</span><span style="color:#b48ead;">pub struct </span><span>BoardPlugin;</span><span>
</span></code></pre>
<p>接着我们在main.rs中添加如下内容</p>
<pre data-lang="rust" style="background-color:#eff1f5;color:#4f5b66;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#a7adba;">// src/main.rs</span><span>
</span><span>
</span><span style="color:#b48ead;">use </span><span>bevy::prelude::*;</span><span>
</span><span>
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">main</span><span>() {</span><span>
</span><span>    </span><span style="color:#b48ead;">let mut</span><span> app = App::new();</span><span>
</span><span>    </span><span style="color:#a7adba;">// 窗口基本设定</span><span>
</span><span>    app.</span><span style="color:#96b5b4;">insert_resource</span><span>(WindowDescriptor {</span><span>
</span><span>        title: &quot;</span><span style="color:#a3be8c;">Mine Sweeper</span><span>&quot;.</span><span style="color:#96b5b4;">to_string</span><span>(),</span><span>
</span><span>        width: </span><span style="color:#d08770;">700.</span><span>,</span><span>
</span><span>        height: </span><span style="color:#d08770;">800.</span><span>,</span><span>
</span><span>        ..Default::default()</span><span>
</span><span>    })</span><span>
</span><span>    </span><span style="color:#a7adba;">// 添加bevy的默认插件</span><span>
</span><span>    .</span><span style="color:#96b5b4;">add_plugins</span><span>(DefaultPlugins);</span><span>
</span><span>    #[</span><span style="color:#bf616a;">cfg</span><span>(feature = &quot;</span><span style="color:#a3be8c;">debug</span><span>&quot;)]</span><span>
</span><span>    </span><span style="color:#a7adba;">// 仅在debug feature下添加调试器</span><span>
</span><span>    app.</span><span style="color:#96b5b4;">add_plugin</span><span>(WorldInspectorPlugin::new());</span><span>
</span><span>    </span><span style="color:#a7adba;">// 添加启动system，用于初始化相机</span><span>
</span><span>    app.</span><span style="color:#96b5b4;">add_startup_system</span><span>(camera_setup);</span><span>
</span><span>    </span><span style="color:#a7adba;">// Run</span><span>
</span><span>    app.</span><span style="color:#96b5b4;">run</span><span>();</span><span>
</span><span>}</span><span>
</span><span>
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">camera_setup</span><span>(</span><span style="color:#b48ead;">mut </span><span style="color:#bf616a;">commands</span><span>: Commands) {</span><span>
</span><span>    </span><span style="color:#a7adba;">// 新建一个 2D 正交相机</span><span>
</span><span>    commands.</span><span style="color:#96b5b4;">spawn_bundle</span><span>(OrthographicCameraBundle::new_2d());</span><span>
</span><span>}</span><span>
</span></code></pre>
<ul>
<li>执行<code>cargo run</code>将会得到一个空窗口</li>
<li>执行<code>cargo run --feature debug</code>会多一个游戏数据调试框，类似于下面这样
<img src="https://fangtaluosi.top/img/blog/2022-03-05/1.png" alt="" />
至此，一个基本框架算是搭建完成了</li>
</ul>
<h2 id="zhi-zuo-you-xi-mian-ban">制作游戏面板</h2>
<p>在lib.rs内添加如下内容</p>
<pre data-lang="rust" style="background-color:#eff1f5;color:#4f5b66;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">mod </span><span>components;</span><span>
</span><span style="color:#b48ead;">pub mod </span><span>resources;</span><span>
</span></code></pre>
<h3 id="zuo-biao-zu-jian">坐标组件</h3>
<p>新建以下文件</p>
<pre data-lang="rust" style="background-color:#eff1f5;color:#4f5b66;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#a7adba;">// src/components/mod.rs</span><span>
</span><span>
</span><span style="color:#b48ead;">mod </span><span>coordinates</span><span>
</span><span>pub use coordinates::Coordinates;</span><span>
</span></code></pre>
<pre data-lang="rust" style="background-color:#eff1f5;color:#4f5b66;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#a7adba;">// src/components/coordinates.rs</span><span>
</span><span>
</span><span style="color:#b48ead;">use </span><span>std::fmt::{</span><span style="color:#bf616a;">self</span><span>, Display, Formatter};</span><span>
</span><span style="color:#b48ead;">use </span><span>std::ops::{Add, Sub};</span><span>
</span><span style="color:#b48ead;">use </span><span>bevy::prelude::Component;</span><span>
</span><span>
</span><span>#[</span><span style="color:#bf616a;">cfg_attr</span><span>(feature = &quot;</span><span style="color:#a3be8c;">debug</span><span>&quot;, </span><span style="color:#bf616a;">derive</span><span>(bevy_inspector_egui::Inspectable))]</span><span>
</span><span>#[</span><span style="color:#bf616a;">derive</span><span>(Debug, Default, Copy, Clone, Ord, PartialOrd, Eq, PartialEq, Hash, Component)]</span><span>
</span><span style="color:#b48ead;">pub struct </span><span>Coordinates {</span><span>
</span><span>    </span><span style="color:#b48ead;">pub </span><span style="color:#bf616a;">x</span><span>: </span><span style="color:#b48ead;">u16</span><span>,</span><span>
</span><span>    </span><span style="color:#b48ead;">pub </span><span style="color:#bf616a;">y</span><span>: </span><span style="color:#b48ead;">u16</span><span>,</span><span>
</span><span>}</span><span>
</span><span>
</span><span style="color:#a7adba;">// 定义坐标和运算，以通过+直接使坐标相加</span><span>
</span><span style="color:#b48ead;">impl </span><span>Add </span><span style="color:#b48ead;">for </span><span>Coordinates {</span><span>
</span><span>    </span><span style="color:#b48ead;">type </span><span>Output = </span><span style="color:#b48ead;">Self</span><span>;</span><span>
</span><span>
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">add</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">rhs</span><span>: </span><span style="color:#b48ead;">Self</span><span>) -&gt; </span><span style="color:#b48ead;">Self::</span><span>Output {</span><span>
</span><span>        </span><span style="color:#b48ead;">Self </span><span>{</span><span>
</span><span>            x: </span><span style="color:#bf616a;">self</span><span>.x + rhs.x,</span><span>
</span><span>            y: </span><span style="color:#bf616a;">self</span><span>.y + rhs.y,</span><span>
</span><span>        }</span><span>
</span><span>    }</span><span>
</span><span>}</span><span>
</span><span>
</span><span style="color:#a7adba;">// 定义坐标差运算</span><span>
</span><span style="color:#b48ead;">impl </span><span>Sub </span><span style="color:#b48ead;">for </span><span>Coordinates {</span><span>
</span><span>    </span><span style="color:#b48ead;">type </span><span>Output = </span><span style="color:#b48ead;">Self</span><span>;</span><span>
</span><span>
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">sub</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">rhs</span><span>: </span><span style="color:#b48ead;">Self</span><span>) -&gt; </span><span style="color:#b48ead;">Self::</span><span>Output {</span><span>
</span><span>        </span><span style="color:#b48ead;">Self </span><span>{</span><span>
</span><span>            x: </span><span style="color:#bf616a;">self</span><span>.x.</span><span style="color:#96b5b4;">saturating_sub</span><span>(rhs.x),</span><span>
</span><span>            y: </span><span style="color:#bf616a;">self</span><span>.y.</span><span style="color:#96b5b4;">saturating_sub</span><span>(rhs.y),</span><span>
</span><span>        }</span><span>
</span><span>    }</span><span>
</span><span>}</span><span>
</span><span>
</span><span style="color:#a7adba;">// 用于调试输出</span><span>
</span><span style="color:#b48ead;">impl </span><span>Display </span><span style="color:#b48ead;">for </span><span>Coordinates {</span><span>
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">fmt</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">f</span><span>: &amp;</span><span style="color:#b48ead;">mut </span><span>Formatter&lt;&#39;_&gt;) -&gt; fmt::Result {</span><span>
</span><span>        write!(f, &quot;</span><span style="color:#a3be8c;">(</span><span style="color:#d08770;">{}</span><span style="color:#a3be8c;">, </span><span style="color:#d08770;">{}</span><span style="color:#a3be8c;">)</span><span>&quot;, </span><span style="color:#bf616a;">self</span><span>.x, </span><span style="color:#bf616a;">self</span><span>.y)</span><span>
</span><span>    }</span><span>
</span><span>}</span><span>
</span></code></pre>
<h3 id="di-zhuan">地砖</h3>
<p>接下来为游戏添加一些资源，新建以下文件，制作游戏中的地砖</p>
<pre data-lang="rust" style="background-color:#eff1f5;color:#4f5b66;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#a7adba;">// src/resources/mod.rs</span><span>
</span><span>
</span><span style="color:#b48ead;">pub</span><span>(</span><span style="color:#b48ead;">crate</span><span>) </span><span style="color:#b48ead;">mod </span><span>tile;</span><span>
</span><span style="color:#b48ead;">pub</span><span>(</span><span style="color:#b48ead;">crate</span><span>) </span><span style="color:#b48ead;">mod </span><span>tile_map;</span><span>
</span></code></pre>
<pre data-lang="rust" style="background-color:#eff1f5;color:#4f5b66;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#a7adba;">// src/resources/tile.rs</span><span>
</span><span>
</span><span>#[</span><span style="color:#bf616a;">cfg</span><span>(feature = &quot;</span><span style="color:#a3be8c;">debug</span><span>&quot;)]</span><span>
</span><span style="color:#b48ead;">use </span><span>colored::Colorize;</span><span>
</span><span>
</span><span style="color:#a7adba;">/// 游戏中的地砖枚举</span><span>
</span><span>#[</span><span style="color:#bf616a;">derive</span><span>(Debug, Copy, Clone, Eq, PartialEq)]</span><span>
</span><span style="color:#b48ead;">pub enum </span><span>Tile {</span><span>
</span><span>    </span><span style="color:#a7adba;">/// 地雷</span><span>
</span><span>    Bomb,</span><span>
</span><span>    </span><span style="color:#a7adba;">/// 周围地雷数</span><span>
</span><span>    BombNeighbor(</span><span style="color:#b48ead;">u8</span><span>),</span><span>
</span><span>    </span><span style="color:#a7adba;">/// 空地砖</span><span>
</span><span>    Empty,</span><span>
</span><span>}</span><span>
</span><span>
</span><span style="color:#b48ead;">impl </span><span>Tile {</span><span>
</span><span>    </span><span style="color:#a7adba;">/// 判断是否为地雷</span><span>
</span><span>    </span><span style="color:#b48ead;">pub const fn </span><span style="color:#8fa1b3;">is_bomb</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">bool </span><span>{</span><span>
</span><span>        matches!(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#b48ead;">Self</span><span>::Bomb)</span><span>
</span><span>    }</span><span>
</span><span>
</span><span>    </span><span style="color:#a7adba;">// 在命令行调试中输出字符串形式的地图，并附带有颜色</span><span>
</span><span>    #[</span><span style="color:#bf616a;">cfg</span><span>(feature = &quot;</span><span style="color:#a3be8c;">debug</span><span>&quot;)]</span><span>
</span><span>    </span><span style="color:#b48ead;">pub fn </span><span style="color:#8fa1b3;">console_output</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; String {</span><span>
</span><span>        format!(</span><span>
</span><span>            &quot;</span><span style="color:#d08770;">{}</span><span>&quot;,</span><span>
</span><span>            </span><span style="color:#b48ead;">match </span><span style="color:#bf616a;">self </span><span>{</span><span>
</span><span>                Tile::Bomb =&gt; &quot;</span><span style="color:#a3be8c;">*</span><span>&quot;.</span><span style="color:#96b5b4;">bright_red</span><span>(),</span><span>
</span><span>                Tile::BombNeighbor(v) =&gt; </span><span style="color:#b48ead;">match</span><span> v {</span><span>
</span><span>                    </span><span style="color:#d08770;">1 </span><span>=&gt; &quot;</span><span style="color:#a3be8c;">1</span><span>&quot;.</span><span style="color:#96b5b4;">cyan</span><span>(),</span><span>
</span><span>                    </span><span style="color:#d08770;">2 </span><span>=&gt; &quot;</span><span style="color:#a3be8c;">2</span><span>&quot;.</span><span style="color:#96b5b4;">green</span><span>(),</span><span>
</span><span>                    </span><span style="color:#d08770;">3 </span><span>=&gt; &quot;</span><span style="color:#a3be8c;">3</span><span>&quot;.</span><span style="color:#96b5b4;">yellow</span><span>(),</span><span>
</span><span>                    _ =&gt; v.</span><span style="color:#96b5b4;">to_string</span><span>().</span><span style="color:#96b5b4;">red</span><span>(),</span><span>
</span><span>                },</span><span>
</span><span>                Tile::Empty =&gt; &quot; &quot;.</span><span style="color:#96b5b4;">normal</span><span>(),</span><span>
</span><span>            }</span><span>
</span><span>        )</span><span>
</span><span>    }</span><span>
</span><span>}</span><span>
</span></code></pre>
<h3 id="sheng-cheng-di-tu">生成地图</h3>
<p>新建如下文件</p>
<pre data-lang="rust" style="background-color:#eff1f5;color:#4f5b66;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#a7adba;">//  src/resources/tile_map.rs</span><span>
</span><span>
</span><span style="color:#b48ead;">use crate</span><span>::resources::tile::Tile;</span><span>
</span><span style="color:#b48ead;">use </span><span>std::ops::{Deref, DerefMut};</span><span>
</span><span>
</span><span style="color:#a7adba;">/// 基本地图</span><span>
</span><span>#[</span><span style="color:#bf616a;">derive</span><span>(Debug, Clone)]</span><span>
</span><span style="color:#b48ead;">pub struct </span><span>TileMap {</span><span>
</span><span>    </span><span style="color:#bf616a;">bomb_count</span><span>: </span><span style="color:#b48ead;">u16</span><span>,</span><span>
</span><span>    </span><span style="color:#bf616a;">height</span><span>: </span><span style="color:#b48ead;">u16</span><span>,</span><span>
</span><span>    </span><span style="color:#bf616a;">width</span><span>: </span><span style="color:#b48ead;">u16</span><span>,</span><span>
</span><span>    </span><span style="color:#bf616a;">map</span><span>: Vec&lt;Vec&lt;Tile&gt;&gt;,</span><span>
</span><span>}</span><span>
</span><span>
</span><span style="color:#b48ead;">impl </span><span>TileMap {</span><span>
</span><span>    </span><span style="color:#a7adba;">/// 生成空地图</span><span>
</span><span>    </span><span style="color:#b48ead;">pub fn </span><span style="color:#8fa1b3;">empty</span><span>(</span><span style="color:#bf616a;">width</span><span>: </span><span style="color:#b48ead;">u16</span><span>, </span><span style="color:#bf616a;">height</span><span>: </span><span style="color:#b48ead;">u16</span><span>) -&gt; </span><span style="color:#b48ead;">Self </span><span>{</span><span>
</span><span>        </span><span style="color:#b48ead;">let</span><span> map = (</span><span style="color:#d08770;">0</span><span>..height)</span><span>
</span><span>            .</span><span style="color:#96b5b4;">into_iter</span><span>()</span><span>
</span><span>            .</span><span style="color:#96b5b4;">map</span><span>(|_| (</span><span style="color:#d08770;">0</span><span>..width).</span><span style="color:#96b5b4;">into_iter</span><span>().</span><span style="color:#96b5b4;">map</span><span>(|_| Tile::Empty).</span><span style="color:#96b5b4;">collect</span><span>())</span><span>
</span><span>            .</span><span style="color:#96b5b4;">collect</span><span>();</span><span>
</span><span>        </span><span style="color:#b48ead;">Self </span><span>{</span><span>
</span><span>            bomb_count: </span><span style="color:#d08770;">0</span><span>,</span><span>
</span><span>            height,</span><span>
</span><span>            width,</span><span>
</span><span>            map,</span><span>
</span><span>        }</span><span>
</span><span>    }</span><span>
</span><span>
</span><span>    #[</span><span style="color:#bf616a;">cfg</span><span>(feature = &quot;</span><span style="color:#a3be8c;">debug</span><span>&quot;)]</span><span>
</span><span>    </span><span style="color:#b48ead;">pub fn </span><span style="color:#8fa1b3;">console_output</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; String {</span><span>
</span><span>        </span><span style="color:#b48ead;">let mut</span><span> buffer = format!(</span><span>
</span><span>            &quot;</span><span style="color:#a3be8c;">Map (</span><span style="color:#d08770;">{}</span><span style="color:#a3be8c;">, </span><span style="color:#d08770;">{}</span><span style="color:#a3be8c;">) with </span><span style="color:#d08770;">{}</span><span style="color:#a3be8c;"> bombs:</span><span style="color:#96b5b4;">\n</span><span>&quot;,</span><span>
</span><span>            </span><span style="color:#bf616a;">self</span><span>.width, </span><span style="color:#bf616a;">self</span><span>.height, </span><span style="color:#bf616a;">self</span><span>.bomb_count</span><span>
</span><span>        );</span><span>
</span><span>        </span><span style="color:#b48ead;">let</span><span> line: String = (</span><span style="color:#d08770;">0</span><span>..=(</span><span style="color:#bf616a;">self</span><span>.width + </span><span style="color:#d08770;">1</span><span>)).</span><span style="color:#96b5b4;">into_iter</span><span>().</span><span style="color:#96b5b4;">map</span><span>(|_| &#39;</span><span style="color:#a3be8c;">-</span><span>&#39;).</span><span style="color:#96b5b4;">collect</span><span>();</span><span>
</span><span>        buffer = format!(&quot;</span><span style="color:#d08770;">{}{}</span><span style="color:#96b5b4;">\n</span><span>&quot;, buffer, line);</span><span>
</span><span>        </span><span style="color:#b48ead;">for</span><span> line in </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#96b5b4;">iter</span><span>().</span><span style="color:#96b5b4;">rev</span><span>() {</span><span>
</span><span>            buffer = format!(&quot;</span><span style="color:#d08770;">{}</span><span style="color:#a3be8c;">|</span><span>&quot;, buffer);</span><span>
</span><span>            </span><span style="color:#b48ead;">for</span><span> tile in line.</span><span style="color:#96b5b4;">iter</span><span>() {</span><span>
</span><span>                buffer = format!(&quot;</span><span style="color:#d08770;">{}{}</span><span>&quot;, buffer, tile.</span><span style="color:#96b5b4;">console_output</span><span>());</span><span>
</span><span>            }</span><span>
</span><span>            buffer = format!(&quot;</span><span style="color:#d08770;">{}</span><span style="color:#a3be8c;">|</span><span style="color:#96b5b4;">\n</span><span>&quot;, buffer);</span><span>
</span><span>        }</span><span>
</span><span>        format!(&quot;</span><span style="color:#d08770;">{}{}</span><span>&quot;, buffer, line)</span><span>
</span><span>    }</span><span>
</span><span>
</span><span>    </span><span style="color:#a7adba;">// 获得宽度</span><span>
</span><span>    </span><span style="color:#b48ead;">pub fn </span><span style="color:#8fa1b3;">width</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">u16 </span><span>{</span><span>
</span><span>        </span><span style="color:#bf616a;">self</span><span>.width</span><span>
</span><span>    }</span><span>
</span><span>
</span><span>    </span><span style="color:#a7adba;">// 获得高度</span><span>
</span><span>    </span><span style="color:#b48ead;">pub fn </span><span style="color:#8fa1b3;">height</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">u16 </span><span>{</span><span>
</span><span>        </span><span style="color:#bf616a;">self</span><span>.height</span><span>
</span><span>    }</span><span>
</span><span>
</span><span>    </span><span style="color:#a7adba;">// 获得周围地雷数</span><span>
</span><span>    </span><span style="color:#b48ead;">pub fn </span><span style="color:#8fa1b3;">bomb_count</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; </span><span style="color:#b48ead;">u16 </span><span>{</span><span>
</span><span>        </span><span style="color:#bf616a;">self</span><span>.bomb_count</span><span>
</span><span>    }</span><span>
</span><span>}</span><span>
</span><span>
</span><span style="color:#b48ead;">impl </span><span>Deref </span><span style="color:#b48ead;">for </span><span>TileMap {</span><span>
</span><span>    </span><span style="color:#b48ead;">type </span><span>Target = Vec&lt;Vec&lt;Tile&gt;&gt;;</span><span>
</span><span>
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">deref</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>) -&gt; &amp;</span><span style="color:#b48ead;">Self::</span><span>Target {</span><span>
</span><span>        &amp;</span><span style="color:#bf616a;">self</span><span>.map</span><span>
</span><span>    }</span><span>
</span><span>}</span><span>
</span><span>
</span><span style="color:#b48ead;">impl </span><span>DerefMut </span><span style="color:#b48ead;">for </span><span>TileMap {</span><span>
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">deref_mut</span><span>(&amp;</span><span style="color:#b48ead;">mut </span><span style="color:#bf616a;">self</span><span>) -&gt; &amp;</span><span style="color:#b48ead;">mut Self::</span><span>Target {</span><span>
</span><span>        &amp;</span><span style="color:#b48ead;">mut </span><span style="color:#bf616a;">self</span><span>.map</span><span>
</span><span>    }</span><span>
</span><span>}</span><span>
</span><span>
</span><span style="color:#a7adba;">/// 每个格子周围八个坐标</span><span>
</span><span style="color:#b48ead;">const </span><span style="color:#d08770;">SQUARE_COORDINATES</span><span>: [(</span><span style="color:#b48ead;">i8</span><span>, </span><span style="color:#b48ead;">i8</span><span>); </span><span style="color:#d08770;">8</span><span>] = [</span><span>
</span><span>    </span><span style="color:#a7adba;">// 左下</span><span>
</span><span>    (-</span><span style="color:#d08770;">1</span><span>, -</span><span style="color:#d08770;">1</span><span>),</span><span>
</span><span>    </span><span style="color:#a7adba;">// 正下</span><span>
</span><span>    (</span><span style="color:#d08770;">0</span><span>, -</span><span style="color:#d08770;">1</span><span>),</span><span>
</span><span>    </span><span style="color:#a7adba;">// 右下</span><span>
</span><span>    (</span><span style="color:#d08770;">1</span><span>, -</span><span style="color:#d08770;">1</span><span>),</span><span>
</span><span>    </span><span style="color:#a7adba;">// 正左</span><span>
</span><span>    (-</span><span style="color:#d08770;">1</span><span>, </span><span style="color:#d08770;">0</span><span>),</span><span>
</span><span>    </span><span style="color:#a7adba;">// 正右</span><span>
</span><span>    (</span><span style="color:#d08770;">1</span><span>, </span><span style="color:#d08770;">0</span><span>),</span><span>
</span><span>    </span><span style="color:#a7adba;">// 左上</span><span>
</span><span>    (-</span><span style="color:#d08770;">1</span><span>, </span><span style="color:#d08770;">1</span><span>),</span><span>
</span><span>    </span><span style="color:#a7adba;">// 正上</span><span>
</span><span>    (</span><span style="color:#d08770;">0</span><span>, </span><span style="color:#d08770;">1</span><span>),</span><span>
</span><span>    </span><span style="color:#a7adba;">// 右上</span><span>
</span><span>    (</span><span style="color:#d08770;">1</span><span>, </span><span style="color:#d08770;">1</span><span>),</span><span>
</span><span>];</span><span>
</span></code></pre>
<p>为了检索每个格子周围的八个格子，添加以下方法</p>
<pre data-lang="rust" style="background-color:#eff1f5;color:#4f5b66;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#a7adba;">//  src/resources/tile_map.rs</span><span>
</span><span style="color:#b48ead;">use crate</span><span>::components::Coordinates;</span><span>
</span><span>
</span><span style="color:#a7adba;">// ..</span><span>
</span><span>
</span><span>    </span><span style="color:#b48ead;">pub fn </span><span style="color:#8fa1b3;">safe_square_at</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">coordinates</span><span>: Coordinates) -&gt; impl Iterator&lt;Item = Coordinates&gt; {</span><span>
</span><span>        </span><span style="color:#d08770;">SQUARE_COORDINATES</span><span>
</span><span>            .</span><span style="color:#96b5b4;">iter</span><span>()</span><span>
</span><span>            .</span><span style="color:#96b5b4;">copied</span><span>()</span><span>
</span><span>            .</span><span style="color:#96b5b4;">map</span><span>(</span><span style="color:#b48ead;">move </span><span>|tuple| coordinates + tuple)</span><span>
</span><span>    }</span><span>
</span></code></pre>
<p>为了能让坐标与u8元组相加，我们需要再添加一个坐标相加方法</p>
<pre data-lang="rust" style="background-color:#eff1f5;color:#4f5b66;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#a7adba;">// src/components/coordinates.rs</span><span>
</span><span>
</span><span style="color:#b48ead;">impl </span><span>Add&lt;(</span><span style="color:#b48ead;">i8</span><span>, </span><span style="color:#b48ead;">i8</span><span>)&gt; </span><span style="color:#b48ead;">for </span><span>Coordinates {</span><span>
</span><span>    </span><span style="color:#b48ead;">type </span><span>Output = </span><span style="color:#b48ead;">Self</span><span>;</span><span>
</span><span>
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">add</span><span>(</span><span style="color:#bf616a;">self</span><span>, (</span><span style="color:#bf616a;">x</span><span>, </span><span style="color:#bf616a;">y</span><span>): (</span><span style="color:#b48ead;">i8</span><span>, </span><span style="color:#b48ead;">i8</span><span>)) -&gt; </span><span style="color:#b48ead;">Self::</span><span>Output {</span><span>
</span><span>        </span><span style="color:#b48ead;">let</span><span> x = ((</span><span style="color:#bf616a;">self</span><span>.x as </span><span style="color:#b48ead;">i16</span><span>) + x as </span><span style="color:#b48ead;">i16</span><span>) as </span><span style="color:#b48ead;">u16</span><span>;</span><span>
</span><span>        </span><span style="color:#b48ead;">let</span><span> y = ((</span><span style="color:#bf616a;">self</span><span>.y as </span><span style="color:#b48ead;">i16</span><span>) + y as </span><span style="color:#b48ead;">i16</span><span>) as </span><span style="color:#b48ead;">u16</span><span>;</span><span>
</span><span>        </span><span style="color:#b48ead;">Self </span><span>{ x, y }</span><span>
</span><span>    }</span><span>
</span><span>}</span><span>
</span></code></pre>
<p>现在我们可以检索周围的地砖，并计算坐标周围的地雷数来填充格子了</p>
<pre data-lang="rust" style="background-color:#eff1f5;color:#4f5b66;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#a7adba;">// src/resources/tile_map.rs</span><span>
</span><span>
</span><span style="color:#a7adba;">// ..</span><span>
</span><span>
</span><span>    </span><span style="color:#b48ead;">pub fn </span><span style="color:#8fa1b3;">is_bomb_at</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">coordinates</span><span>: Coordinates) -&gt; </span><span style="color:#b48ead;">bool </span><span>{</span><span>
</span><span>        </span><span style="color:#b48ead;">if</span><span> coordinates.x &gt;= </span><span style="color:#bf616a;">self</span><span>.width || coordinates.y &gt;= </span><span style="color:#bf616a;">self</span><span>.height {</span><span>
</span><span>            </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">false</span><span>;</span><span>
</span><span>        };</span><span>
</span><span>        </span><span style="color:#bf616a;">self</span><span>.map[coordinates.y as </span><span style="color:#b48ead;">usize</span><span>][coordinates.x as </span><span style="color:#b48ead;">usize</span><span>].</span><span style="color:#96b5b4;">is_bomb</span><span>()</span><span>
</span><span>    }</span><span>
</span><span>
</span><span>    </span><span style="color:#b48ead;">pub fn </span><span style="color:#8fa1b3;">bomb_count_at</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">coordinates</span><span>: Coordinates) -&gt; </span><span style="color:#b48ead;">u8 </span><span>{</span><span>
</span><span>        </span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#96b5b4;">is_bomb_at</span><span>(coordinates) {</span><span>
</span><span>            </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">0</span><span>;</span><span>
</span><span>        }</span><span>
</span><span>        </span><span style="color:#b48ead;">let</span><span> res = </span><span style="color:#bf616a;">self</span><span>
</span><span>            .</span><span style="color:#96b5b4;">safe_square_at</span><span>(coordinates)</span><span>
</span><span>            .</span><span style="color:#96b5b4;">filter</span><span>(|</span><span style="color:#bf616a;">coord</span><span>| </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#96b5b4;">is_bomb_at</span><span>(*coord))</span><span>
</span><span>            .</span><span style="color:#96b5b4;">count</span><span>();</span><span>
</span><span>        res as </span><span style="color:#b48ead;">u8</span><span>
</span><span>    }</span><span>
</span></code></pre>
<p>下面通过随机数来生成地图，放置地雷</p>
<pre data-lang="rust" style="background-color:#eff1f5;color:#4f5b66;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#a7adba;">// src/resources/tile_map.rs</span><span>
</span><span style="color:#b48ead;">use </span><span>rand::{thread_rng, Rng};</span><span>
</span><span style="color:#a7adba;">// ..</span><span>
</span><span>    </span><span style="color:#a7adba;">/// 放置地雷及普通格子</span><span>
</span><span>    </span><span style="color:#b48ead;">pub fn </span><span style="color:#8fa1b3;">set_bombs</span><span>(&amp;</span><span style="color:#b48ead;">mut </span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">bomb_count</span><span>: </span><span style="color:#b48ead;">u16</span><span>) {</span><span>
</span><span>        </span><span style="color:#bf616a;">self</span><span>.bomb_count = bomb_count;</span><span>
</span><span>        </span><span style="color:#b48ead;">let mut</span><span> remaining_bombs = bomb_count;</span><span>
</span><span>        </span><span style="color:#b48ead;">let mut</span><span> rng = </span><span style="color:#96b5b4;">thread_rng</span><span>();</span><span>
</span><span>        </span><span style="color:#a7adba;">// 生成地雷</span><span>
</span><span>        </span><span style="color:#b48ead;">while</span><span> remaining_bombs &gt; </span><span style="color:#d08770;">0 </span><span>{</span><span>
</span><span>            </span><span style="color:#b48ead;">let </span><span>(x, y) = (</span><span>
</span><span>                rng.</span><span style="color:#96b5b4;">gen_range</span><span>(</span><span style="color:#d08770;">0</span><span>..</span><span style="color:#bf616a;">self</span><span>.width) as </span><span style="color:#b48ead;">usize</span><span>,</span><span>
</span><span>                rng.</span><span style="color:#96b5b4;">gen_range</span><span>(</span><span style="color:#d08770;">0</span><span>..</span><span style="color:#bf616a;">self</span><span>.height) as </span><span style="color:#b48ead;">usize</span><span>,</span><span>
</span><span>            );</span><span>
</span><span>            </span><span style="color:#b48ead;">if let </span><span>Tile::Empty = </span><span style="color:#bf616a;">self</span><span>[y][x] {</span><span>
</span><span>                </span><span style="color:#bf616a;">self</span><span>[y][x] = Tile::Bomb;</span><span>
</span><span>                remaining_bombs -= </span><span style="color:#d08770;">1</span><span>;</span><span>
</span><span>            }</span><span>
</span><span>        }</span><span>
</span><span>        </span><span style="color:#a7adba;">// 生成普通地砖</span><span>
</span><span>        </span><span style="color:#b48ead;">for</span><span> y in </span><span style="color:#d08770;">0</span><span>..</span><span style="color:#bf616a;">self</span><span>.height {</span><span>
</span><span>            </span><span style="color:#b48ead;">for</span><span> x in </span><span style="color:#d08770;">0</span><span>..</span><span style="color:#bf616a;">self</span><span>.width {</span><span>
</span><span>                </span><span style="color:#b48ead;">let</span><span> coords = Coordinates { x, y };</span><span>
</span><span>                </span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#96b5b4;">is_bomb_at</span><span>(coords) {</span><span>
</span><span>                    </span><span style="color:#b48ead;">continue</span><span>;</span><span>
</span><span>                }</span><span>
</span><span>                </span><span style="color:#b48ead;">let</span><span> num = </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#96b5b4;">bomb_count_at</span><span>(coords);</span><span>
</span><span>                </span><span style="color:#b48ead;">if</span><span> num == </span><span style="color:#d08770;">0 </span><span>{</span><span>
</span><span>                    </span><span style="color:#b48ead;">continue</span><span>;</span><span>
</span><span>                }</span><span>
</span><span>                </span><span style="color:#b48ead;">let</span><span> tile = &amp;</span><span style="color:#b48ead;">mut </span><span style="color:#bf616a;">self</span><span>[y as </span><span style="color:#b48ead;">usize</span><span>][x as </span><span style="color:#b48ead;">usize</span><span>];</span><span>
</span><span>                *tile = Tile::BombNeighbor(num);</span><span>
</span><span>            }</span><span>
</span><span>        }</span><span>
</span><span>    }</span><span>
</span></code></pre>
<h3 id="ce-shi-cha-jian">测试插件</h3>
<p>下面把我们目前所做的封装成插件
在lib.rs中加入如下内容</p>
<pre data-lang="rust" style="background-color:#eff1f5;color:#4f5b66;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#a7adba;">// src/lib.rs</span><span>
</span><span style="color:#b48ead;">pub mod </span><span>components;</span><span>
</span><span style="color:#b48ead;">pub mod </span><span>resources;</span><span>
</span><span>
</span><span style="color:#b48ead;">use </span><span>bevy::log;</span><span>
</span><span style="color:#b48ead;">use </span><span>bevy::prelude::*;</span><span>
</span><span style="color:#b48ead;">use </span><span>resources::tile_map::TileMap;</span><span>
</span><span>
</span><span style="color:#a7adba;">/// 游戏面板插件</span><span>
</span><span style="color:#b48ead;">pub struct </span><span>BoardPlugin;</span><span>
</span><span>
</span><span style="color:#b48ead;">impl </span><span>Plugin </span><span style="color:#b48ead;">for </span><span>BoardPlugin {</span><span>
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">build</span><span>(&amp;</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">app</span><span>: &amp;</span><span style="color:#b48ead;">mut</span><span> App) {</span><span>
</span><span>        app.</span><span style="color:#96b5b4;">add_startup_system</span><span>(</span><span style="color:#b48ead;">Self</span><span>::create_board);</span><span>
</span><span>        log::info!(&quot;</span><span style="color:#a3be8c;">Loaded Board Plugin</span><span>&quot;);</span><span>
</span><span>    }</span><span>
</span><span>}</span><span>
</span><span>
</span><span style="color:#b48ead;">impl </span><span>BoardPlugin {</span><span>
</span><span>    </span><span style="color:#a7adba;">/// 生成面板</span><span>
</span><span>    </span><span style="color:#b48ead;">pub fn </span><span style="color:#8fa1b3;">create_board</span><span>() {</span><span>
</span><span>        </span><span style="color:#b48ead;">let mut</span><span> tile_map = TileMap::empty(</span><span style="color:#d08770;">20</span><span>, </span><span style="color:#d08770;">20</span><span>);</span><span>
</span><span>        tile_map.</span><span style="color:#96b5b4;">set_bombs</span><span>(</span><span style="color:#d08770;">40</span><span>);</span><span>
</span><span>        #[</span><span style="color:#bf616a;">cfg</span><span>(feature = &quot;</span><span style="color:#a3be8c;">debug</span><span>&quot;)]</span><span>
</span><span>        log::info!(&quot;</span><span style="color:#a3be8c;">{}</span><span>&quot;, tile_map.</span><span style="color:#96b5b4;">console_output</span><span>());</span><span>
</span><span>    }</span><span>
</span><span>}</span><span>
</span></code></pre>
<p>接下来在main.rs文件中调用插件进行测试吧</p>
<pre data-lang="rust" style="background-color:#eff1f5;color:#4f5b66;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#a7adba;">// src/main.rs</span><span>
</span><span>
</span><span style="color:#b48ead;">use </span><span>minesweeper::BoardPlugin;</span><span>
</span><span>
</span><span style="color:#a7adba;">// ..</span><span>
</span><span> </span><span style="color:#a7adba;">// 添加游戏面板插件</span><span>
</span><span> app.</span><span style="color:#96b5b4;">add_plugin</span><span>(BoardPlugin);</span><span>
</span><span>
</span></code></pre>
<p>执行<code>cargo run --features debug</code>，会有类似于以下输出</p>
<pre data-lang="text" style="background-color:#eff1f5;color:#4f5b66;" class="language-text "><code class="language-text" data-lang="text"><span>2022-03-05T10:45:33.299087Z  INFO bevy_render::renderer: AdapterInfo { name: &quot;NVIDIA GeForce GTX 1660 Ti with Max-Q Design&quot;, vendor: 4318, device: 8593, device_type: DiscreteGpu, backend: Vulkan }</span><span>
</span><span>2022-03-05T10:45:33.777658Z  INFO minesweeper: Loaded Board Plugin</span><span>
</span><span>2022-03-05T10:45:33.808146Z  INFO minesweeper: Map (20, 20) with 40 bombs:</span><span>
</span><span>----------------------</span><span>
</span><span>|  12211111221     11|</span><span>
</span><span>|  1**11*12**1     1*|</span><span>
</span><span>|  12322112*31111 122|</span><span>
</span><span>|    1*1  111 1*1 1*1|</span><span>
</span><span>|11  111      1111221|</span><span>
</span><span>|*1      11211   1*1 |</span><span>
</span><span>|2311  112*3*1   111 |</span><span>
</span><span>|*2*21 1*33*21       |</span><span>
</span><span>|233*1123*321 111111 |</span><span>
</span><span>|1*2111*22*21 1*11*1 |</span><span>
</span><span>|1111121112*1 2221232|</span><span>
</span><span>|   1*2111221 1*1 1**|</span><span>
</span><span>|   123*11*1  111 122|</span><span>
</span><span>|   12*21111         |</span><span>
</span><span>| 112*211221         |</span><span>
</span><span>| 1*211 1**1         |</span><span>
</span><span>| 111   1221         |</span><span>
</span><span>|           111      |</span><span>
</span><span>|     111   1*1 111  |</span><span>
</span><span>|     1*1   111 1*1  |</span><span>
</span><span>----------------------</span><span>
</span></code></pre>

</div>
</main>
    <!-- 分页 --> <!--snow雪花组件-->
    <div id="snow"></div>
    <!--loading组件-->
    <div class="loading" id="loading">
<div class="left"></div>
<div class="right"></div>
<script>
    $(window).on("load", function () {
        $(".loading").addClass("loaded")
    });
    $(window).on("load", function () {
        setTimeout(function () {
            $(".loading").fadeOut("slow");
        }, 1000);
    });
</script>

<!--加载动画组件-->
<link rel="stylesheet" href=https://fangtaluosi.top/css/basic/loading-2.css>
<div class="wrapper">
    <div class="rocket">
        <i class="iconfont icon-huojian"></i>
        <i class="iconfont icon-yun" style = "--i:0;"></i>
        <i class="iconfont icon-yun" style = "--i:1;"></i>
        <i class="iconfont icon-yun" style = "--i:2;"></i>
        <i class="iconfont icon-yun" style = "--i:3;"></i>
    </div>
    <span><i></i></span>
</div>
</div>
    <footer>
<div class="footer-wrap">
    <p>&copy;芳塔洛斯 Powered by Zola</p>
    <div id="flying-fish" class="flying-fish"></div>
    <div class="back"></div>
</div>
</footer>
</body>

</html>